# Dynamic Analysis

- Note: Always correlate data with Static Analysis.

## Network Based Indicators

### Capture Procedure

- Start `inetsim` in REMnux machine.
- Connect FlareVM to the REMnux machine network (Use REMnux IP as DNS server).
- Open `Wireshark` in REMnux machine and start capturing.
- Filter for HTTP, DNS... traffic.
- Follow streams (Always start with high layer protocols).
- Extract C2 servers and URLs.

### DNS

- We have to see DNS traffic in `Wireshark`.
- Extract the domain that is being queried.
- Add the domain to the hosts file in FlareVM pointing to localhost.
- Search for TCP operations of the binary in `procmon`.
  - This will reveal useful information in the path field. For example, the protocol or port that is being used.
- Listen in the revealed port for a connection.
- Run the binary and wait for a connection.
- Try different things in order to explore the functionality of the open socket. For example, system commands as `whoami`.

## Host Based Indicators

### Procmon

#### Features

- Registry activity.
- Filesystem activity.
- Process activity.
- Network activity.

#### Filter

- Process Name: Filter by the name of the process (Same as the name of the executable).
- PID: Filter by the Process ID of the binary.
- Operation: Filter by names of performed operations. For example, file to get all the operations related to files.
- Detail: Filter by details. For example, commands executed with `cmd.exe` will appear in details.
- Path: Filter by path. 

### TCPView

- Analyzes the TCP connections that a binary performs.
- Good practice to correlate with `Procmon` operations.

## Program Execution Flow

- Indicates the high-level steps followed by the binary at execution time.
- Always analyze what happens if the binary is in a sandbox environment (No Internet).
