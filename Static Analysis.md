<!-- omit in toc -->
# Static Analysis

<!-- omit in toc -->
## Table of Contents

1. [Notes](#notes)
2. [Hashing](#hashing)
   1. [In the Wild](#in-the-wild)
3. [Strings](#strings)
   1. [What can be revealed?](#what-can-be-revealed)
   2. [Tools](#tools)
4. [PE](#pe)
5. [File Structure](#file-structure)
   1. [Interesting Fields](#interesting-fields)
      1. [PEview](#peview)
      2. [PEstudio](#pestudio)
6. [Packing](#packing)
   1. [Features](#features)
   2. [UPX](#upx)

## Notes

- Malware does not need to be armed.

## Hashing

- MD5: `md5sum.exe Malware.exe.malz`.
- SHA1: `sha1sum.exe Malware.exe.malz`.
- SHA256: `sha256sum.exe Malware.exe.malz`.

### In the Wild

- `virustotal.com`: Search > Paste hashes > See if the malware has been seen in the wild.

## Strings

### What can be revealed?

- C2 Servers.
- URLs.
- Function names.

### Tools

- `strings`:
  - `-n`: Minimum string length [3].
  - `-a`: Only ASCII.
  - `-u`: Only Unicode.
  - `-s`: Recurse subdirectories.
- `floss`: Analyze >4 char strings in ASCII and Unicode format.

## PE

## File Structure

1. MZ header [Hex: 4D 5A]: Windows Portable Executable Signature.
2. PE Header:
   1. Image Information.
   2. Section Information.
   3. Directory.
3. Section 1:N.

### Interesting Fields

#### PEview

- Compile Timestamp:
  - IMAGE_NT_HEADERS > IMAGE_FILE_HEADER > Time Date Stamp.
  - Old dates can indicate that AVs might detect it.
  - Borland Delphi compiled executables have a date from 1992.
- Virtual Size:
  - IMAGE_SECTION_HEADER .text > Virtual Size.
  - Indicates the size that the executable uses when loaded on memory.
  - If it is a lot bigger than Size of Raw, it can indicate that the binary is packed.
- Size of Raw:
  - IMAGE_SECTION_HEADER .text > Size of Raw data.
- IAT (Import Address Table):
  - Section .rdata > IMPORT Address Table.
  - [Microsoft Docs](https://learn.microsoft.com/en-us/windows/win32/api/)
  - [MalAPI.io](https://malapi.io/)

#### PEstudio

- General properties:
  - MD5, SHA1 and SHA256 hashes.
  - First bytes (Hex and text).
  - File-size.
  - Entropy.
  - Signature.
  - File-type.
  - CPU.
  - Compiler stamp.
  - Debugger stamp.
- Indicators: It tries to identify malicious activities (Certain strings, functions) and ranks them depending on criticality.
- Libraries: All the DLLs that the binary uses.
  - Flag: A blacklist that identifies the potential malicious libraries.
- Strings: Sort in base to different parameters of strings (Size, offset, encoding).
  - Flag: A blacklist that identifies the potential malicious strings.

## Packing

### Features

- Unpacks the binary in execution time.
- Reduces the size of the binary.
- Obfuscates the contents of the binary.
- AV Evasion.

### UPX

- It changes the section names to `UPX{N}`.
- Few imports in address table.
  - `GetProcAddress` and `LoadLibraryA` used to identify new imports during runtime.
- Big difference between `Size of Raw Data` and `Virtual Size`.
